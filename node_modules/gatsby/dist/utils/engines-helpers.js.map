{"version":3,"file":"engines-helpers.js","names":["shouldPrintEngineSnapshot","process","env","gatsby_executing_command","generate","shouldSendTelemetryForHeadAPI","shouldGenerateEngines","emitter","on","action","payload","mode","serverData","config","Head","trackFeatureIsUsed","shouldBundleDatastore","store","getState","adapter","excludeDatastoreFromEngineFunction","getCDNObfuscatedPath","path","status","cdnObfuscatedPrefix","LmdbOnCdnPath","currentTarget","platform","arch","getCurrentPlatformAndTarget","getFunctionsTargetPlatformAndTarget","state","GATSBY_FUNCTIONS_PLATFORM","program","functionsPlatform","GATSBY_FUNCTIONS_ARCH","functionsArch"],"sources":["../../src/utils/engines-helpers.ts"],"sourcesContent":["import { emitter, store } from \"../redux\"\nimport { ICreatePageAction, ISetComponentFeatures } from \"../redux/types\"\nimport { trackFeatureIsUsed } from \"gatsby-telemetry\"\n\nexport function shouldPrintEngineSnapshot(): boolean {\n  return process.env.gatsby_executing_command === `build`\n}\n\nlet generate = false\nlet shouldSendTelemetryForHeadAPI = true\nexport function shouldGenerateEngines(): boolean {\n  return process.env.gatsby_executing_command === `build` && generate\n}\n\nemitter.on(`CREATE_PAGE`, (action: ICreatePageAction) => {\n  if (action.payload.mode && action.payload.mode !== `SSG`) generate = true\n})\nemitter.on(`SET_COMPONENT_FEATURES`, (action: ISetComponentFeatures) => {\n  if (action.payload.serverData) generate = true\n  if (action.payload.config) generate = true\n  if (action.payload.Head && shouldSendTelemetryForHeadAPI) {\n    trackFeatureIsUsed(`HeadAPI`)\n    shouldSendTelemetryForHeadAPI = false\n  }\n})\n\nexport function shouldBundleDatastore(): boolean {\n  return !store.getState().adapter.config.excludeDatastoreFromEngineFunction\n}\n\nfunction getCDNObfuscatedPath(path: string): string {\n  return `${store.getState().status.cdnObfuscatedPrefix}-${path}`\n}\n\nexport const LmdbOnCdnPath = getCDNObfuscatedPath(`data.mdb`)\n\nexport interface IPlatformAndArch {\n  platform: string\n  arch: string\n}\n\nconst currentTarget: IPlatformAndArch = {\n  platform: process.platform,\n  arch: process.arch,\n}\n\nexport function getCurrentPlatformAndTarget(): IPlatformAndArch {\n  return currentTarget\n}\n\nexport function getFunctionsTargetPlatformAndTarget(): IPlatformAndArch {\n  const state = store.getState()\n\n  return {\n    platform:\n      process.env.GATSBY_FUNCTIONS_PLATFORM ??\n      state.program.functionsPlatform ??\n      state.adapter.config.functionsPlatform ??\n      currentTarget.platform,\n    arch:\n      process.env.GATSBY_FUNCTIONS_ARCH ??\n      state.program.functionsArch ??\n      state.adapter.config.functionsArch ??\n      currentTarget.arch,\n  }\n}\n"],"mappings":";;;;;;;;;AAAA;AAEA;AAEO,SAASA,yBAAyB,GAAY;EACnD,OAAOC,OAAO,CAACC,GAAG,CAACC,wBAAwB,KAAM,OAAM;AACzD;AAEA,IAAIC,QAAQ,GAAG,KAAK;AACpB,IAAIC,6BAA6B,GAAG,IAAI;AACjC,SAASC,qBAAqB,GAAY;EAC/C,OAAOL,OAAO,CAACC,GAAG,CAACC,wBAAwB,KAAM,OAAM,IAAIC,QAAQ;AACrE;AAEAG,cAAO,CAACC,EAAE,CAAE,aAAY,EAAGC,MAAyB,IAAK;EACvD,IAAIA,MAAM,CAACC,OAAO,CAACC,IAAI,IAAIF,MAAM,CAACC,OAAO,CAACC,IAAI,KAAM,KAAI,EAAEP,QAAQ,GAAG,IAAI;AAC3E,CAAC,CAAC;AACFG,cAAO,CAACC,EAAE,CAAE,wBAAuB,EAAGC,MAA6B,IAAK;EACtE,IAAIA,MAAM,CAACC,OAAO,CAACE,UAAU,EAAER,QAAQ,GAAG,IAAI;EAC9C,IAAIK,MAAM,CAACC,OAAO,CAACG,MAAM,EAAET,QAAQ,GAAG,IAAI;EAC1C,IAAIK,MAAM,CAACC,OAAO,CAACI,IAAI,IAAIT,6BAA6B,EAAE;IACxD,IAAAU,mCAAkB,EAAE,SAAQ,CAAC;IAC7BV,6BAA6B,GAAG,KAAK;EACvC;AACF,CAAC,CAAC;AAEK,SAASW,qBAAqB,GAAY;EAC/C,OAAO,CAACC,YAAK,CAACC,QAAQ,EAAE,CAACC,OAAO,CAACN,MAAM,CAACO,kCAAkC;AAC5E;AAEA,SAASC,oBAAoB,CAACC,IAAY,EAAU;EAClD,OAAQ,GAAEL,YAAK,CAACC,QAAQ,EAAE,CAACK,MAAM,CAACC,mBAAoB,IAAGF,IAAK,EAAC;AACjE;AAEO,MAAMG,aAAa,GAAGJ,oBAAoB,CAAE,UAAS,CAAC;AAAA;AAO7D,MAAMK,aAA+B,GAAG;EACtCC,QAAQ,EAAE1B,OAAO,CAAC0B,QAAQ;EAC1BC,IAAI,EAAE3B,OAAO,CAAC2B;AAChB,CAAC;AAEM,SAASC,2BAA2B,GAAqB;EAC9D,OAAOH,aAAa;AACtB;AAEO,SAASI,mCAAmC,GAAqB;EAAA;EACtE,MAAMC,KAAK,GAAGd,YAAK,CAACC,QAAQ,EAAE;EAE9B,OAAO;IACLS,QAAQ,4CACN1B,OAAO,CAACC,GAAG,CAAC8B,yBAAyB,yEACrCD,KAAK,CAACE,OAAO,CAACC,iBAAiB,yCAC/BH,KAAK,CAACZ,OAAO,CAACN,MAAM,CAACqB,iBAAiB,uCACtCR,aAAa,CAACC,QAAQ;IACxBC,IAAI,8CACF3B,OAAO,CAACC,GAAG,CAACiC,qBAAqB,2EACjCJ,KAAK,CAACE,OAAO,CAACG,aAAa,yCAC3BL,KAAK,CAACZ,OAAO,CAACN,MAAM,CAACuB,aAAa,yCAClCV,aAAa,CAACE;EAClB,CAAC;AACH"}