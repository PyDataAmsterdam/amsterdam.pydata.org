{"version":3,"file":"joi.js","names":["stripTrailingSlash","chain","replace","addLeadingSlash","when","Joi","string","uri","relativeOnly","then","gatsbyConfigSchema","object","keys","flags","polyfill","boolean","default","assetPrefix","allowRelative","pathPrefix","allow","linkPrefix","forbidden","error","Error","siteMetadata","siteUrl","unknown","mapping","plugins","array","proxy","items","prefix","required","url","single","partytownProxiedURLs","developMiddleware","func","jsxRuntime","valid","jsxImportSource","trailingSlash","graphqlTypegen","alternatives","typesOutputPath","DEFAULT_TYPES_OUTPUT_PATH","documentSearchPaths","DEFAULT_DOCUMENT_SEARCH_PATHS","generateOnBuild","custom","value","headers","source","key","adapter","name","cache","restore","store","adapt","config","pageSchema","path","matchPath","component","componentChunkName","context","pluginCreator___NODE","pluginCreatorId","nodeSchema","id","children","parent","fields","internal","contentDigest","mediaType","type","owner","fieldOwners","content","description","ignoreType","counter","number","contentFilePath"],"sources":["../../src/joi-schemas/joi.ts"],"sourcesContent":["import Joi from \"joi\"\nimport { IGatsbyConfig, IGatsbyPage, IGatsbyNode } from \"../redux/types\"\nimport {\n  DEFAULT_DOCUMENT_SEARCH_PATHS,\n  DEFAULT_TYPES_OUTPUT_PATH,\n} from \"../utils/graphql-typegen/ts-codegen\"\n\nconst stripTrailingSlash = (chain: Joi.StringSchema): Joi.StringSchema =>\n  chain.replace(/(\\w)\\/+$/, `$1`)\n\n// only add leading slash on relative urls\nconst addLeadingSlash = (chain: Joi.StringSchema): Joi.StringSchema =>\n  chain.when(Joi.string().uri({ relativeOnly: true }), {\n    then: chain.replace(/^([^/])/, `/$1`),\n  })\n\nexport const gatsbyConfigSchema: Joi.ObjectSchema<IGatsbyConfig> = Joi.object()\n  .keys({\n    flags: Joi.object(),\n    polyfill: Joi.boolean().default(true),\n    assetPrefix: stripTrailingSlash(\n      Joi.string().uri({\n        allowRelative: true,\n      })\n    ),\n    pathPrefix: addLeadingSlash(\n      stripTrailingSlash(\n        Joi.string()\n          .uri({\n            allowRelative: true,\n            relativeOnly: true,\n          })\n          .default(``)\n          // removes single / value\n          .allow(``)\n          .replace(/^\\/$/, ``)\n      )\n    ),\n    linkPrefix: Joi.forbidden().error(\n      new Error(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n    ),\n    siteMetadata: Joi.object({\n      siteUrl: stripTrailingSlash(Joi.string()).uri(),\n    }).unknown(),\n    mapping: Joi.object(),\n    plugins: Joi.array(),\n    proxy: Joi.array()\n      .items(\n        Joi.object().keys({\n          prefix: Joi.string().required(),\n          url: Joi.string().required(),\n        })\n      )\n      .single(),\n    partytownProxiedURLs: Joi.array().items(Joi.string()),\n    developMiddleware: Joi.func(),\n    jsxRuntime: Joi.string().valid(`automatic`, `classic`).default(`classic`),\n    jsxImportSource: Joi.string(),\n    trailingSlash: Joi.string()\n      .valid(`always`, `never`, `ignore`)\n      .default(`always`),\n    graphqlTypegen: Joi.alternatives(\n      Joi.boolean(),\n      Joi.object()\n        .keys({\n          typesOutputPath: Joi.string().default(DEFAULT_TYPES_OUTPUT_PATH),\n          documentSearchPaths: Joi.array()\n            .items(Joi.string())\n            .default(DEFAULT_DOCUMENT_SEARCH_PATHS),\n          generateOnBuild: Joi.boolean().default(false),\n        })\n        .unknown(false)\n    )\n      .default(false)\n      .custom(value => {\n        if (value === true) {\n          return {\n            typesOutputPath: DEFAULT_TYPES_OUTPUT_PATH,\n            documentSearchPaths: DEFAULT_DOCUMENT_SEARCH_PATHS,\n            generateOnBuild: false,\n          }\n        }\n\n        return value\n      }),\n    headers: Joi.array()\n      .items(\n        Joi.object()\n          .keys({\n            source: Joi.string().required(),\n            headers: Joi.array()\n              .items(\n                Joi.object()\n                  .keys({\n                    key: Joi.string().required(),\n                    value: Joi.string().required(),\n                  })\n                  .required()\n                  .unknown(false)\n              )\n              .required(),\n          })\n          .unknown(false)\n      )\n      .default([]),\n    adapter: Joi.object()\n      .keys({\n        name: Joi.string().required(),\n        cache: Joi.object()\n          .keys({\n            restore: Joi.func(),\n            store: Joi.func(),\n          })\n          .unknown(false),\n        adapt: Joi.func().required(),\n        config: Joi.func(),\n      })\n      .unknown(false),\n  })\n  // throws when both assetPrefix and pathPrefix are defined\n  .when(\n    Joi.object({\n      assetPrefix: Joi.string().uri({\n        allowRelative: true,\n        relativeOnly: true,\n      }),\n      pathPrefix: Joi.string()\n        .uri({\n          allowRelative: true,\n          relativeOnly: true,\n        })\n        .default(``),\n    }),\n    {\n      then: Joi.object({\n        assetPrefix: Joi.string()\n          .uri({\n            allowRelative: false,\n          })\n          .error(\n            new Error(\n              `assetPrefix must be an absolute URI when used with pathPrefix`\n            )\n          ),\n      }),\n    }\n  )\n\nexport const pageSchema: Joi.ObjectSchema<IGatsbyPage> = Joi.object()\n  .keys({\n    path: Joi.string().required(),\n    matchPath: Joi.string(),\n    component: Joi.string().required(),\n    componentChunkName: Joi.string().required(),\n    context: Joi.object(),\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    pluginCreator___NODE: Joi.string(),\n    pluginCreatorId: Joi.string(),\n  })\n  .unknown()\n\nexport const nodeSchema: Joi.ObjectSchema<IGatsbyNode> = Joi.object()\n  .keys({\n    id: Joi.string().required(),\n    children: Joi.array().items(Joi.string(), Joi.object().forbidden()),\n    parent: Joi.string().allow(null),\n    fields: Joi.object(),\n    internal: Joi.object()\n      .keys({\n        contentDigest: Joi.string().required(),\n        mediaType: Joi.string(),\n        type: Joi.string().required(),\n        owner: Joi.string().required(),\n        fieldOwners: Joi.object(),\n        content: Joi.string().allow(``),\n        description: Joi.string(),\n        ignoreType: Joi.boolean(),\n        counter: Joi.number(),\n        contentFilePath: Joi.string(),\n      })\n      .unknown(false), // Don't allow non-standard fields\n  })\n  .unknown()\n"],"mappings":"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"}