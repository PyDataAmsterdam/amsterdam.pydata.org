/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define(["exports"],A):A((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function A(e,A,t,n){return new(t||(t=Promise))((function(r,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var A;e.done?r(e.value):(A=e.value,A instanceof t?A:new t((function(e){e(A)}))).then(i,s)}a((n=n.apply(e,A||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class t{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((A=>{e=A}))}dispatch(e){return A(this,void 0,void 0,(function*(){const A=yield this.lock();try{return yield Promise.resolve(e())}finally{A()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=null!==(n=r.Buffer)&&void 0!==n?n:null,i=r.TextEncoder?new r.TextEncoder:null;function s(e,A){return(15&e)+(e>>6|e>>3&8)<<4|(15&A)+(A>>6|A>>3&8)}const a="a".charCodeAt(0)-10,c="0".charCodeAt(0);function l(e,A,t){let n=0;for(let r=0;r<t;r++){let t=A[r]>>>4;e[n++]=t>9?t+a:t+c,t=15&A[r],e[n++]=t>9?t+a:t+c}return String.fromCharCode.apply(null,e)}const f=null!==o?e=>{if("string"==typeof e){const A=o.from(e,"utf8");return new Uint8Array(A.buffer,A.byteOffset,A.length)}if(o.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return i.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=new Uint8Array(256);for(let e=0;e<g.length;e++)B[g.charCodeAt(e)]=e;function h(e){const A=function(e){let A=Math.floor(.75*e.length);const t=e.length;return"="===e[t-1]&&(A-=1,"="===e[t-2]&&(A-=1)),A}(e),t=e.length,n=new Uint8Array(A);let r=0;for(let A=0;A<t;A+=4){const t=B[e.charCodeAt(A)],o=B[e.charCodeAt(A+1)],i=B[e.charCodeAt(A+2)],s=B[e.charCodeAt(A+3)];n[r]=t<<2|o>>4,r+=1,n[r]=(15&o)<<4|i>>2,r+=1,n[r]=(3&i)<<6|63&s,r+=1}return n}const d=16384,E=new t,Q=new Map;function u(e,t){return A(this,void 0,void 0,(function*(){let n=null,r=null,o=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const i=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),a=E.dispatch((()=>A(this,void 0,void 0,(function*(){if(!Q.has(e.name)){const A=h(e.data),t=WebAssembly.compile(A);Q.set(e.name,t)}const A=yield Q.get(e.name);n=yield WebAssembly.instantiate(A,{})})))),c=(e=null)=>{o=!0,n.exports.Hash_Init(e)},g=e=>{if(!o)throw new Error("update() called before init()");(e=>{let A=0;for(;A<e.length;){const t=e.subarray(A,A+d);A+=t.length,r.set(t),n.exports.Hash_Update(t.length)}})(f(e))},B=new Uint8Array(2*t),u=(e,A=null)=>{if(!o)throw new Error("digest() called before init()");return o=!1,n.exports.Hash_Final(A),"binary"===e?r.slice(0,t):l(B,r,t)},C=e=>"string"==typeof e?e.length<4096:e.byteLength<d;let y=C;switch(e.name){case"argon2":case"scrypt":y=()=>!0;break;case"blake2b":case"blake2s":y=(e,A)=>A<=512&&C(e);break;case"blake3":y=(e,A)=>0===A&&C(e);break;case"xxhash64":case"xxhash3":case"xxhash128":y=()=>!1}return yield(()=>A(this,void 0,void 0,(function*(){n||(yield a);const e=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,e,d)})))(),{getMemory:()=>r,writeMemory:(e,A=0)=>{r.set(e,A)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const A=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,A,e)},init:c,update:g,digest:u,save:()=>{if(!o)throw new Error("save() can only be called after init() and before digest()");const A=n.exports.Hash_GetState(),t=i(),r=n.exports.memory.buffer,a=new Uint8Array(r,A,t),c=new Uint8Array(4+t);return function(e,A){const t=A.length>>1;for(let n=0;n<t;n++){const t=n<<1;e[n]=s(A.charCodeAt(t),A.charCodeAt(t+1))}}(c,e.hash),c.set(a,4),c},load:A=>{if(!(A instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const t=n.exports.Hash_GetState(),r=i(),a=4+r,c=n.exports.memory.buffer;if(A.length!==a)throw new Error(`Bad state length (expected ${a} bytes, got ${A.length})`);if(!function(e,A){if(e.length!==2*A.length)return!1;for(let t=0;t<A.length;t++){const n=t<<1;if(A[t]!==s(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,A.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const l=A.subarray(4);new Uint8Array(c,t,r).set(l),o=!0},calculate:(e,A=null,o=null)=>{if(!y(e,A))return c(A),g(e),u("hex",o);const i=f(e);return r.set(i),n.exports.Hash_Calculate(i.length,A,o),l(B,r,t)},hashLength:t}}))}var C={name:"crc32",data:"AGFzbQEAAAABEQRgAAF/YAF/AGAAAGACf38AAwgHAAEBAQIAAwUEAQECAgYOAn8BQZDJBQt/AEGACAsHcAgGbWVtb3J5AgAOSGFzaF9HZXRCdWZmZXIAAAlIYXNoX0luaXQAAgtIYXNoX1VwZGF0ZQADCkhhc2hfRmluYWwABA1IYXNoX0dldFN0YXRlAAUOSGFzaF9DYWxjdWxhdGUABgpTVEFURV9TSVpFAwEKkggHBQBBgAkLwwMBA39BgIkBIQFBACECA0AgAUEAQQBBAEEAQQBBAEEAQQAgAkEBcWsgAHEgAkEBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnMiA0EBcWsgAHEgA0EBdnM2AgAgAUEEaiEBIAJBAWoiAkGAAkcNAAtBACEAA0AgAEGEkQFqIABBhIkBaigCACICQf8BcUECdEGAiQFqKAIAIAJBCHZzIgI2AgAgAEGEmQFqIAJB/wFxQQJ0QYCJAWooAgAgAkEIdnMiAjYCACAAQYShAWogAkH/AXFBAnRBgIkBaigCACACQQh2cyICNgIAIABBhKkBaiACQf8BcUECdEGAiQFqKAIAIAJBCHZzIgI2AgAgAEGEsQFqIAJB/wFxQQJ0QYCJAWooAgAgAkEIdnMiAjYCACAAQYS5AWogAkH/AXFBAnRBgIkBaigCACACQQh2cyICNgIAIABBhMEBaiACQf8BcUECdEGAiQFqKAIAIAJBCHZzNgIAIABBBGoiAEH8B0cNAAsLJwACQEEAKAKAyQEgAEYNACAAEAFBACAANgKAyQELQQBBADYChMkBC4gDAQN/QQAoAoTJAUF/cyEBQYAJIQICQCAAQQhJDQBBgAkhAgNAIAJBBGooAgAiA0EOdkH8B3FBgJEBaigCACADQRZ2QfwHcUGAiQFqKAIAcyADQQZ2QfwHcUGAmQFqKAIAcyADQf8BcUECdEGAoQFqKAIAcyACKAIAIAFzIgFBFnZB/AdxQYCpAWooAgBzIAFBDnZB/AdxQYCxAWooAgBzIAFBBnZB/AdxQYC5AWooAgBzIAFB/wFxQQJ0QYDBAWooAgBzIQEgAkEIaiECIABBeGoiAEEHSw0ACwsCQCAARQ0AAkACQCAAQQFxDQAgACEDDAELIAFB/wFxIAItAABzQQJ0QYCJAWooAgAgAUEIdnMhASACQQFqIQIgAEF/aiEDCyAAQQFGDQADQCABQf8BcSACLQAAc0ECdEGAiQFqKAIAIAFBCHZzIgFB/wFxIAJBAWotAABzQQJ0QYCJAWooAgAgAUEIdnMhASACQQJqIQIgA0F+aiIDDQALC0EAIAFBf3M2AoTJAQsyAQF/QQBBACgChMkBIgBBGHQgAEGA/gNxQQh0ciAAQQh2QYD+A3EgAEEYdnJyNgKACQsGAEGEyQELWQACQEEAKAKAyQEgAUYNACABEAFBACABNgKAyQELQQBBADYChMkBIAAQA0EAQQAoAoTJASIBQRh0IAFBgP4DcUEIdHIgAUEIdkGA/gNxIAFBGHZycjYCgAkLCwsBAEGACAsEBAAAAA==",hash:"d2eba587"};const y=new t;let I=null;e.crc32c=function(e){if(null===I)return function(e,t,n){return A(this,void 0,void 0,(function*(){const A=yield e.lock(),r=yield u(t,n);return A(),r}))}(y,C,4).then((A=>(I=A,I.calculate(e,2197175160))));try{const A=I.calculate(e,2197175160);return Promise.resolve(A)}catch(e){return Promise.reject(e)}},e.createCRC32C=function(){return u(C,4).then((e=>{e.init(2197175160);const A={init:()=>(e.init(2197175160),A),update:t=>(e.update(t),A),digest:A=>e.digest(A),save:()=>e.save(),load:t=>(e.load(t),A),blockSize:4,digestSize:4};return A}))}}));
